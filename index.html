<!DOCTYPE html>
<html lang="en">
<head>
    <title>Ogame Share</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS -->
    <link rel="stylesheet" href="public/css/bootstrap.min.css">
    <link rel="stylesheet" href="public/css/app.css">

    <!-- Font awesome -->
    <link rel="stylesheet" href="public/assets/fontawesome/css/all.min.css">

    <!-- JS -->
    <script src="public/js/vue.js"></script>
    <script src="public/js/vue-components.js"></script>
    <script src="public/js/jquery.min.js"></script>
    <script src="public/js/bootstrap.bundle.min.js"></script>
    <script src="public/js/translation.js"></script>
    <script src="public/js/helpers.js"></script>
    <script src="public/js/mixins.js"></script>

    <!-- Factories -->
    <script src="public/js/factories.js"></script>

    <!-- Ogame -->
    <script src="public/js/ogame.js"></script>

</head>

<body>
    <div id="app" class="container pb-3">
        <h1 class="text-center mb-4 mt-4">Ogame Share</h1>

        <p class="text-center">
            <em class="fw-bold">L'nsertion via API est prévue un peu plus tard, pas d'inquiétude ;) ♥<br/> Vous me direz si vous voulez de nouvelles fonctionnalités</em>
        </p>

        <form>
            <div class="row">
                <div class="col-sm-3 rounded-2 p-3" v-for="(player, index) in data_form.players">
                    <div class="mb-2 d-flex justify-content-between">
                        <div>
                            <input v-model="player.name" type="text">
                        </div>
                        <div>
                            <button
                                class="btn btn-danger btn-xs"
                                v-on:click.stop.prevent="deletePlayer(index)"
                                v-if="data_form.players.length > 1"
                            >
                                <span class="fa fa-trash-can"></span>
                            </button>
                        </div>
                    </div>

                    <h2>{{ player.name != '' ? player.name : 'Joueur ' + parseInt(index+1) }}</h2>
                    <hr class="mt-0">

                    <h3>Butin</h3>

                    <my-input-number
                        v-for="(ress, key) in loots"
                        :key="key"
                        v-model="player.loot[ress]"
                        v-bind:params='{
                            label: trd(ress),
                            class_input: ress
                        }'
                    ></my-input-number>

                    <hr>

                    <h3>Pertes</h3>

                    <my-input-number
                        v-for="(ship, key) in ships"
                        :key="key"
                        v-model="player.ships[ship]"
                        v-bind:params='{
                            label: trd(ship)
                        }'
                    ></my-input-number>

                    <button
                        class="btn btn-outline-secondary btn-sm w-100 mt-3"
                        type="button"
                        v-on:click.stop.prevent="resetFields(index)"
                    >Effacer</button>
                </div>

                <div class="col-12 col-sm-1 p-3 text-center">
                    <button
                        type="button"
                        class="btn btn-success btn-xs"
                        v-on:click.stop.prevent="addPlayer()"
                        v-if="data_form.players.length < 5"
                    >
                        <span class="fa fa-plus"></span>
                    </button>
                </div>

                <hr class="m-0">

                <div class="col-12 text-sm-end text-center rounded-2 mt-3">
                    <button
                        class="btn btn-sm btn-success"
                        type="submit"
                        v-on:click.stop.prevent="calculate()"
                    >Calculer</button>
                </div>
            </div>

            <div class="row mt-3 text-center" v-if="results">
                <div class="col-12 h4">
                    <p>Les ressources sont divisés par {{ data_form.players.length }} joueurs</p>
                </div>
                <div class="col-sm-3 col-12 mb-3" v-for="(result, player) in results">
                    <h2>{{ player }}</h2>

                    <ul class="list-unstyled">
                        <li
                            v-for="ress in ['metal', 'crystal', 'deuterium']"
                            v-bind:class="ress"
                            class="h5"
                        >
                            {{ trd(ress) }} :
                            <span
                                v-bind:class="lossCalculation(player, ress, true) >= 0 ? 'text-success' : 'text-danger'"
                                class="fw-bold"
                            >
                                {{ formatFr(lossCalculation(player, ress, true)) }}
                            </span>
                        </li>

                        <li class="mt-3 h5 fw-bold">
                            <b>Total</b> : <span v-bind:class="lossTotal(player) >= 0 ? 'text-success' : 'text-danger'">{{ formatFr(lossTotal(player)) }}</span>
                        </li>
                    </ul>

                    <div>
                        <hr>
                         

                        <p><b>{{ player }}</b> doit {{ excessLoot(player) }} à un joueur déficient :</p>

                        <ul class="list-unstyled">
                            <li>Métal : 0</li>
                            <li>Crystal : 0</li>
                            <li>Deutérium : 0</li>
                        </ul>
                    </div>
                </div>

                <div class="col-12 text-sm-end text-center">
                    <button class="btn btn-outline-danger btn-sm" type="button" v-on:click.stop.prevent="refreshAll()">Réinitialiser</button>
                </div>
            </div>
        </form>
    </div>

    <script src="public/js/app.js"></script>
</body>
</html>